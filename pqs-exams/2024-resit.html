<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.52">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Programming and Quantitative Skills 2024 Resit</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="2024-resit_files/libs/clipboard/clipboard.min.js"></script>
<script src="2024-resit_files/libs/quarto-html/quarto.js"></script>
<script src="2024-resit_files/libs/quarto-html/popper.min.js"></script>
<script src="2024-resit_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="2024-resit_files/libs/quarto-html/anchor.min.js"></script>
<link href="2024-resit_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2024-resit_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="2024-resit_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="2024-resit_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="2024-resit_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Programming and Quantitative Skills 2024 Resit</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><link rel="preconnect" href="https://fonts.googleapis.com"> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""> <link href="https://fonts.googleapis.com/css2?family=Fira+Mono&amp;family=Fira+Sans&amp;display=swap" rel="stylesheet"></p>
<section id="short-answer-questions-5-points" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="short-answer-questions-5-points">Short-Answer Questions (5 points)</h2>
<p>Write an R command that calculates the following:</p>
<p><span class="math display">
\frac{|-4| + e^2}{3}
</span> where <span class="math inline">|x|</span> is the absolute value of <span class="math inline">x</span>.</p>
<p>Provide both the numerical answer and the R command.</p>
<section id="question-2-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-2-1-point">Question 2 (1 point)</h3>
<p>Write an R command that calculates <span class="math inline">\log_2\left(3\right)</span>.</p>
<p>Provide both the numerical answer and the R command.</p>
</section>
<section id="question-3-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-3-1-point">Question 3 (1 point)</h3>
<p>If we create the following vector in R, what class will it be?</p>
<pre><code>c(TRUE, "TRUE")</code></pre>
<ul>
<li>Numeric.</li>
<li>Logical.</li>
<li>Character.</li>
<li>Both numeric and logical.</li>
<li>Both logical and character.</li>
</ul>
<p><em>Note:</em> You do not need to supply your code for this question.</p>
</section>
<section id="question-4-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-4-1-point">Question 4 (1 point)</h3>
<p>Write an R command that generates a numeric vector containing the following sequence:</p>
<p><span class="math display">
(10, 20, 30, \dots, 280, 290, 300, 10, 20, 30, \dots, 280, 290, 300)
</span> The resulting vector should have 60 elements.</p>
</section>
<section id="question-5-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-5-1-point">Question 5 (1 point)</h3>
<p>Write a single numerical value of <code>x</code> in the box below that would return <code>TRUE</code> after running the following R command:</p>
<p><code>!(x &gt; 2) &amp; !(x &lt; 0)</code></p>
<p>There are multiple correct answers. You will be marked as correct if your answer falls in the range of correct answers.</p>
</section>
</section>
<section id="data-analysis-5-points" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="data-analysis-5-points">Data Analysis (5 points)</h2>
<p>Download the dataset <a href="https://walshc.github.io/pqs/startups.csv">startups.csv</a>. The dataset contains information on startups with the following variables:</p>
<ul>
<li><code>r_and_d_spend</code>: The total spending on research and development (in $).</li>
<li><code>marketing_spend</code>: The total spending on marketing (in $).</li>
<li><code>state</code>: The state in the US the startup is located.</li>
<li><code>profit</code>: The profits of the startup (in $).</li>
</ul>
<p>When reading the dataset into R, assign it to <code>df</code>.</p>
<section id="question-6-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-6-1-point">Question 6 (1 point)</h3>
<p>How many observations (rows) are in the dataset?</p>
<p>Provide both the numerical answer and the R command required to obtain the answer (if the dataframe is assigned to <code>df</code>).</p>
</section>
<section id="question-7-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-7-1-point">Question 7 (1 point)</h3>
<p>What is the mean of the variable <code>r_and_d_spend</code>?</p>
<p>Provide both the numerical answer and the R command required to obtain the answer (if the dataframe is assigned to <code>df</code>).</p>
</section>
<section id="question-8-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-8-1-point">Question 8 (1 point)</h3>
<p>What is the median of the variable <code>marketing_spend</code>?</p>
<p>Provide both the numerical answer and the R command required to obtain the answer (if the dataframe is assigned to <code>df</code>).</p>
</section>
<section id="question-9-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-9-1-point">Question 9 (1 point)</h3>
<p>What is the mean of the variable <code>profit</code> for startups in California?</p>
<p>Provide both the numerical answer and the R command required to obtain the answer (if the dataframe is assigned to <code>df</code>).</p>
</section>
<section id="question-10-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-10-1-point">Question 10 (1 point)</h3>
<p>In the dataset, how many startups are located in either New York or Florida?</p>
<p>Provide both the numerical answer and the R command required to obtain the answer (if the dataframe is assigned to <code>df</code>).</p>
</section>
</section>
<section id="data-cleaning-4-points" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="data-cleaning-4-points">Data Cleaning (4 points)</h2>
<p>Download the dataset <a href="https://walshc.github.io/pqs/global.csv">global.csv</a>. The dataset contains the estimated annual global carbon emissions from 1751 to 2010 in million metric tons of CO<span class="math inline">_2</span> (variable <code>Carbon</code>). It also contains the estimated per capita carbon emissions from 1950-2010 in metric tons of CO<span class="math inline">_2</span> (variable <code>Per.Capita</code>). This was obtained by dividing the variable <code>Carbon</code> by the global population and multiplying by 1000000 (one million).</p>
<p>Download the following <a href="https://walshc.github.io/pqs-exams/2024-resit-block-3-template.R">template script</a>. Use it to clean the data and answer the questions that follow. In question 11 you will be required to upload your data cleaning script.</p>
<p>When reading the dataset into R, assign it to <code>df</code> (as done in the template script).</p>
<p>You should do the following cleaning tasks to your dataframe <code>df</code> in this order:</p>
<ol type="1">
<li>Format the <code>Date</code> variable to a date.</li>
<li>In the variable <code>Per.Capita</code>, replace <code>"missing"</code> with <code>NA</code>. This occurs in all years up to and including 1949.</li>
<li>Convert the variable <code>Per.Capita</code> to numeric.</li>
<li>Rename <code>Per.Capita</code> to <code>carbon_per_capita</code>.</li>
<li>Convert all remaining variable names to lower case.</li>
</ol>
<p>If you did all the steps correctly, you should have 260 observations. The average of the <code>carbon</code> variable should be 1402.788 and the average of the <code>carbon_per_capita</code> variable should be 1.055 (when using the command <code>summary(df$carbon_per_capita)</code>). If only some of these match your cleaned dataset, you will still be able to answer some of the questions correctly.</p>
<section id="question-11-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-11-1-point">Question 11 (1 point)</h3>
<p>Upload your script that cleans the data according to the steps in the block introduction.</p>
</section>
<section id="question-12-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-12-1-point">Question 12 (1 point)</h3>
<p>In the cleaned dataset, how many non-missing values are there for the variable <code>carbon_per_capita</code>?</p>
</section>
<section id="question-14-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-14-1-point">Question 14 (1 point)</h3>
<p>Using the cleaned dataset, plot the variable <code>carbon</code> over time. Choose the answer below which best describes what we see in the plot.</p>
<ul>
<li>The variable <code>carbon</code> increased in the 1800s during the industrial revolution, but has since decreased due to greater use of renewable energy.</li>
<li>The variable <code>carbon</code> is fluctuating randomly over time with no clear trend.</li>
<li>Apart from some small fluctuations, the variable <code>carbon</code> is growing exponentially over time.</li>
<li>The variable <code>carbon</code> is decreasing over time.</li>
</ul>
</section>
<section id="question-14-1-point-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-14-1-point-1">Question 14 (1 point)</h3>
<p>Using the variables <code>carbon</code> and <code>carbon_per_capita</code>, find the earth’s population in 2010 expressed in billions (accurate to 3 decimal places).</p>
<p><em>Note:</em> At the time this exam was created, the earth’s population was estimated to be 8,198,542,931. So to express this in billions accurate to 3 decimal places we would divide by 1000000000 (one billion) to get 8.199 (rounded to 3 decimal places). Note also that the variable <code>carbon</code> is expressed in millions of tons of CO<span class="math inline">_2</span>, whereas <code>carbon_per_capita</code> is expressed in tons of CO<span class="math inline">_2</span> per person.</p>
</section>
</section>
<section id="optimization-3-points" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="optimization-3-points">Optimization (3 points)</h2>
<p>The following 3 questions will involve working with the following mathematical function defined over all real numbers <span class="math inline">x</span>:</p>
<p><span class="math display">f(x) = 10 + 3x - x^2</span></p>
<section id="question-15-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-15-1-point">Question 15 (1 point)</h3>
<p>Plot the function between the <span class="math inline">x</span> values <span class="math inline">-3</span> and <span class="math inline">+5</span>. Choose the answer below which best describes the shape of this function:</p>
<ul>
<li>Straight line</li>
<li>Flat</li>
<li>U shape</li>
<li>Inverted U shape (upside-down U)</li>
</ul>
</section>
<section id="question-16-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-16-1-point">Question 16 (1 point)</h3>
<p>Use R to find the value of <span class="math inline">x</span> at an extreme point of this function.</p>
</section>
<section id="question-17-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-17-1-point">Question 17 (1 point)</h3>
<p>What value does the function take at the extreme point?</p>
</section>
</section>
<section id="merging-reshaping-and-aggregating-3-points" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="merging-reshaping-and-aggregating-3-points">Merging, Reshaping and Aggregating (3 points)</h2>
<p>Download the two datasets:</p>
<ol type="1">
<li><a href="https://walshc.github.io/pqs/revenue-by-state-2024.csv">revenue-by-state-2024.csv</a> - this dataset contains 3 variables: <code>state</code>, <code>region</code> and <code>revenue</code>. The dataset contains the revenue (in dollars) for a company from 2024 in 41 US states and their corresponding region.</li>
<li><a href="https://walshc.github.io/pqs/followers-by-state-2024.csv">followers-by-state-2024.csv</a> - this dataset contains 2 variables: <code>state</code>, and <code>followers</code>. The dataset contains the number of followers on social media for the same company in 2024 in the same 41 US states as the revenue data.</li>
</ol>
<section id="question-18-1-points" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-18-1-points">Question 18 (1 points)</h3>
<p>Assuming the <code>revenue-by-state-2024.csv</code> dataset has been read into R as <code>df1</code>, write an R command in the box below that finds the total revenue by region. The output of your command should be:</p>
<pre><code>         region revenue
1 North Central 4125257
2     Northeast 3509775
3         South 4719654
4          West 7250169</code></pre>
</section>
<section id="question-19-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-19-1-point">Question 19 (1 point)</h3>
<p>Merge the datasets <code>revenue-by-state-2024.csv</code> and <code>followers-by-state-2024.csv</code> by the variable <code>state</code>. Use the <code>ggplot2</code> package to create a scatter plot with <code>followers</code> on the horizontal axis and <code>revenue</code> on the vertical axis. Choose the answer below which best describes how to interpret this plot.</p>
<ul>
<li>There does not appear to be any relationship between social media followers and revenue. Whether the number of followers is low or high, the value of revenue is roughly the same.</li>
<li>There does not appear to be any relationship between social media followers and revenue. Whether revenue is low or high, the number of followers is roughly the same.</li>
<li>Where the number of followers is high, revenue tends to be low. Where the number of followers is low, revenue tends to be high.</li>
<li>Where the number of followers is high, revenue tends to be high. Where the number of followers is low, revenue tends to be low.</li>
</ul>
</section>
<section id="question-20-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-20-1-point">Question 20 (1 point)</h3>
<p>Suppose instead of the datasets in the block introduction you received the following file instead: <a href="https://walshc.github.io/pqs/revenue-followers-by-state-2024.csv">revenue-followers-by-state-2024.csv</a>. Read in this dataset into R as <code>df3</code>.</p>
<p>Assuming the <code>reshape2</code> package has been correctly loaded with the command <code>library(reshape2)</code>, write a command in the box below that will transform <code>df3</code> to the following:</p>
<pre><code>            state followers revenue
1         Alabama     16882  364882
2         Arizona     65312  622312
3      California     51330  596330
4        Colorado     69775  622775
5     Connecticut     41180  608180
6        Delaware     23375  290375
7         Florida     12172  297172
8         Georgia     24752  315752
9          Hawaii     52464  739464
10          Idaho     59933  744933
11       Illinois     22272  447272
12        Indiana     26141  432141
13         Kansas     39924  390924
14       Kentucky     20276  279276
15      Louisiana     12481  345481
16       Maryland     29085  233085
17       Michigan     39416  494416
18    Mississippi     24931  311931
19       Missouri     26525  513525
20        Montana     51709  591709
21       Nebraska     35483  467483
22  New Hampshire     53475  646475
23     New Jersey     48468  598468
24     New Mexico     52670  581670
25       New York     46752  523752
26 North Carolina     19463  319463
27           Ohio     37888  527888
28       Oklahoma     17047  297047
29         Oregon     69998  637998
30   Rhode Island     45305  547305
31 South Carolina     20130  306130
32   South Dakota     35292  366292
33      Tennessee     19741  347741
34          Texas     21158  359158
35           Utah     60703  708703
36        Vermont     57595  585595
37       Virginia     26451  357451
38     Washington     65672  735672
39  West Virginia     22710  294710
40      Wisconsin     28316  485316
41        Wyoming     50603  668603</code></pre>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>