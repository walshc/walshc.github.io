<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Programming for E&amp;BI 2025 Resit</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="2025-resit_files/libs/clipboard/clipboard.min.js"></script>
<script src="2025-resit_files/libs/quarto-html/quarto.js"></script>
<script src="2025-resit_files/libs/quarto-html/popper.min.js"></script>
<script src="2025-resit_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="2025-resit_files/libs/quarto-html/anchor.min.js"></script>
<link href="2025-resit_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2025-resit_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="2025-resit_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="2025-resit_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="2025-resit_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="2025-resit.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Programming for E&amp;BI 2025 Resit</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><link rel="preconnect" href="https://fonts.googleapis.com"> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""> <link href="https://fonts.googleapis.com/css2?family=Fira+Mono&amp;family=Fira+Sans&amp;display=swap" rel="stylesheet"></p>
<section id="short-answer-questions-4-points" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="short-answer-questions-4-points">Short-Answer Questions (4 points)</h2>
<section id="question-1-2-points" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-1-2-points">Question 1 (2 points)</h3>
<p>Write an R command that calculates the following:</p>
<p><span class="math display">
\frac{\frac{3}{4} + \log_2\left(12\right)}{\sqrt{10}}
</span></p>
<p>Provide both the numerical answer and the R command.</p>
</section>
<section id="question-2-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-2-1-point">Question 2 (1 point)</h3>
<p>Write an R command in the box below that generates a sequence of 20 evenly-spaced values starting from 0 and ending in 1.</p>
<p>The first two elements of your sequence should be <code>0.00000000</code> and <code>0.05263158</code>.</p>
<p>Your answer must use a sequence-generating function. It is not permitted to write out the full vector manually.</p>
</section>
<section id="question-3-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-3-1-point">Question 3 (1 point)</h3>
<p>Consider the following 2 vectors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>cities <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Amsterdam"</span>, <span class="st">"Brussels"</span>, <span class="st">"Paris"</span>, <span class="st">"Rotterdam"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>dutch_cities <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Amsterdam"</span>, <span class="st">"Den Haag"</span>, <span class="st">"Rotterdam"</span>, <span class="st">"Utrecht"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Write an R command using the <code>%in%</code> operator that returns the elements of <code>cities</code> that are contained in the vector <code>dutch_cities</code>. The code you provide in your answer does not need to include these above 2 lines .</p>
<p>The output of your command should be <code>[1] "Amsterdam" "Rotterdam"</code></p>
</section>
<section id="question-4-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-4-1-point">Question 4 (1 point)</h3>
<p>Define <code>x</code> as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">7</span>, <span class="dv">3</span>, <span class="sc">-</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Writing an R command in the box below using the <code>ifelse()</code> function that takes <code>x</code> as input and returns a character vector with <code>"positive"</code> whenever <code>x</code> is positive and <code>"not positive"</code> whenever <code>x</code> is not positive.</p>
<p>The output of your command should be <code>[1] "positive"     "not positive" "positive"     "not positive"</code>.</p>
</section>
</section>
<section id="data-analysis-5-points" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="data-analysis-5-points">Data Analysis (5 points)</h2>
<p>Download the dataset <a href="https://walshc.github.io/ebi-prog/sales-data-dec-2025.csv">sales-data-dec-2025.csv</a>. The dataset contains information on the total sales of a firm for different furniture products in different cities where it has stores in December 2025. The variable descriptions are:</p>
<ul>
<li><code>product</code>: The product (<code>Sofa</code>, <code>Chair</code> or <code>Table</code>).</li>
<li><code>city</code>: The city where the store is (<code>Tilburg</code>, <code>Breda</code>, <code>Eindhoven</code> or <code>'s-Hertogenbosch</code>).</li>
<li><code>price</code>: The selling price of the product.</li>
<li><code>sales</code>: The total number of units sold of that product in that city in December 2025.</li>
</ul>
<p>When reading the dataset into R, assign it to <code>df</code>.</p>
<section id="question-5-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-5-1-point">Question 5 (1 point)</h3>
<p>What is the mean of the variable <code>sales</code>?</p>
<p>Provide both the numerical answer and the R command required to obtain the answer (if the dataframe is assigned to <code>df</code>).</p>
</section>
<section id="question-6-2-points" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-6-2-points">Question 6 (2 points)</h3>
<p>Part (a): Write an R command in the box below that creates a new variable in <code>df</code> called <code>revenue</code>, which is price multiplied by sales.</p>
<p>Part (b): Write an R command in the box below that returns the total revenue from chair sales across the 4 cities.</p>
</section>
<section id="question-7-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-7-1-point">Question 7 (1 point)</h3>
<p>Write an R command in the box below using the <code>aggregate()</code> function that returns the total number of units sold for each product.</p>
</section>
<section id="question-8-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-8-1-point">Question 8 (1 point)</h3>
<p>Using an appropriate function from the <code>reshape2</code> package, write an R command in the box below to reshape the data such that there are 4 rows, one for each city, and the columns are:</p>
<ul>
<li>The city.</li>
<li>The sales of chairs in each city.</li>
<li>The sales of sofas in each city.</li>
<li>The sales of tables in each city.</li>
</ul>
<p>The output should be the following:</p>
<pre><code>              city Chair Sofa Table
1 's-Hertogenbosch   286  147   113
2            Breda   240   41    72
3        Eindhoven   285   63    45
4          Tilburg   293   41    60</code></pre>
<p><strong>Hint:</strong> Load the <code>reshape2</code> package using the command <code>library(reshape2)</code>. You do not need to include loading this package in your answer.</p>
</section>
</section>
<section id="data-cleaning-and-analysis-9-points" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="data-cleaning-and-analysis-9-points">Data Cleaning and Analysis (9 points)</h2>
<p>Download the following two datasets:</p>
<ul>
<li><a href="https://walshc.github.io/pqs/ice-cream-sales-2025.csv">ice-cream-sales-2025.csv</a></li>
<li><a href="https://walshc.github.io/pqs/temperature-2025.csv">temperature-2025.csv</a></li>
</ul>
<p>The first dataset contains the total number of ice cream scoops sold by an ice cream salesman in Tilburg in the summer of 2025 (May 1 to September 30). This salesman takes Mondays off every week, so it says <code>"Day off"</code> for the <code>sales</code> variable on Mondays.</p>
<p>The second dataset contains the daily high temperature in Tilburg on each date from May-September 2025.</p>
<p>When reading the datasets into R, assign <code>ice-cream-sales-2025.csv</code> to <code>df1</code> and <code>temperature-2025.csv</code> to <code>df2</code>.</p>
<p>The next question will involve some data cleaning steps. If you perform these steps correctly, your final dataset should match the following file: <a href="https://walshc.github.io/ebi-prog/ice-cream-sales-2025.csv">temperature-sales-2025.csv</a> If it does not, you can use this file to answer the analysis questions that follow.</p>
<section id="question-9-6-points" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-9-6-points">Question 9 (6 points)</h3>
<p>Perform the following cleaning steps:</p>
<p>Part (a): Write an R command in the box below using the <code>as.Date()</code> function that will correctly format the <code>date</code> variable in <code>df1</code> to an R date.</p>
<p>Part (b): Write an R command in the box below that will drop all Mondays from <code>df1</code>. After this command <code>df1</code> should have 131 rows.</p>
<p>Part (c): Write an R command in the box below that will convert the <code>sales</code> variable in <code>df1</code> to numeric.</p>
<p>Part (d): Write an R command in the box below that will create a variable called <code>weekend</code> that is <code>TRUE</code> if the day of the week is Saturday or Sunday and <code>FALSE</code> otherwise.</p>
<p>Part (e): Write an R command in the box below that will convert the <code>date</code> variable in <code>df2</code> to an R date.</p>
<p>Part (f): Write an R command in the box below that will merge <code>df1</code> and <code>df2</code> by the <code>date</code> variable. Assign the output of this command to <code>df</code>.</p>
</section>
<section id="question-10-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-10-1-point">Question 10 (1 point)</h3>
<p>Using your cleaned dataset (or the cleaned version of the data provided in the block introduction), calculate the average sales on days that were <em>both</em> on the weekend <em>and</em> had a temperature of at least 30 degrees.</p>
</section>
<section id="question-11-2-points" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-11-2-points">Question 11 (2 points)</h3>
<p>Using your cleaned dataset (or the cleaned version of the data provided in the block introduction), plot temperature on the horizontal axis and sales on the vertical axis. Make the color of the points represent the value of the <code>weekend</code> variable.</p>
<p>Use this plot to answer the following two questions.</p>
<p>Part (a): Choose the correct option from the following.</p>
<ul>
<li>Warmer days on average have higher sales compared to cooler days.</li>
<li>Warmer days on average have fewer sales compared to cooler days.</li>
<li>The temperature that sells the most ice cream is about 25C.</li>
<li>There is no clear relationship between temperature and sales in these data.</li>
</ul>
<p>Part (b): Choose the correct option from the following.</p>
<p>Based on the colors of the points:</p>
<ul>
<li>Given the temperature, there are more sales on the weekend compared to during the week.</li>
<li>Given the temperature, there are less sales on the weekend compared to during the week.</li>
<li>Given the temperature, the sales on the weekend are similar to the sales during the week.</li>
<li>Warmer days are more likely on the weekend.</li>
<li>Warmer days are less likely on the weekend.</li>
</ul>
</section>
</section>
<section id="optimization-2-points" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="optimization-2-points">Optimization (2 points)</h2>
<p>The following 3 questions will involve working with the following mathematical function defined over all real numbers <span class="math inline">x</span>:</p>
<p><span class="math display">f(x) = 20 + 8x - 2x^2</span></p>
<section id="question-12-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-12-1-point">Question 12 (1 point)</h3>
<p>Plot the function between the <span class="math inline">x</span> values <span class="math inline">-1</span> and <span class="math inline">+5</span>. Add the correct options in the boxes below that best describe the plot.</p>
<p>Part (a): The shape of the function is <em>a straight line / flat / U-shaped / inverse U-shaped</em>.</p>
<p>Part (b): When <span class="math inline">f(x) = 20</span>, the corresponding values of <span class="math inline">x</span> are <span class="math inline">\_\_\_</span> and <span class="math inline">\_\_\_</span>.</p>
<p>Part (c): At <span class="math inline">x=3</span>, the function is <em>downward-sloping / flat / upward-sloping / vertical</em>.</p>
</section>
<section id="question-13-1-point" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="question-13-1-point">Question 13 (1 point)</h3>
<p>Use R to find the value of <span class="math inline">x</span> at an extreme point of this function.</p>
<p>Part (a): Type this value of <span class="math inline">x</span> in the box below.</p>
<p>Part (b) What value does the function take at the extreme point?</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>